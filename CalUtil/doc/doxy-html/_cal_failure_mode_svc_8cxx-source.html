<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>CalFailureModeSvc.cxx Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.2.16 -->
<center>
<a class="qindex" href="main.html">Main Page</a> &nbsp; <a class="qindex" href="hierarchy.html">Class Hierarchy</a> &nbsp; <a class="qindex" href="annotated.html">Compound List</a> &nbsp; <a class="qindex" href="files.html">File List</a> &nbsp; <a class="qindex" href="functions.html">Compound Members</a> &nbsp; <a class="qindex" href="globals.html">File Members</a> &nbsp; </center>
<hr><h1>CalFailureModeSvc.cxx</h1><a href="_cal_failure_mode_svc_8cxx.html">Go to the documentation of this file.</a><div class="fragment"><pre>00001 <font class="comment">// Implementation file for CalFailureModeSvc which handles the failure mode testing</font>
00002 <font class="comment">// for the CAL.</font>
00003 <font class="comment">// </font>
00004 <font class="comment">//</font>
00005 <font class="comment">// $Header$</font>
00006 <font class="comment">//</font>
00007 <font class="comment">// Author: Richard Dubois</font>
00008 
00009 
00010 <font class="preprocessor">#include "<a class="code" href="_cal_failure_mode_svc_8h.html">CalUtil/CalFailureModeSvc.h</a>"</font>
00011 
00012 <font class="preprocessor">#include "GaudiKernel/MsgStream.h"</font>
00013 <font class="preprocessor">#include "GaudiKernel/SvcFactory.h"</font>
00014 <font class="preprocessor">#include &lt;algorithm&gt;</font>
00015 
00016 
00017 <font class="comment">// declare the service factories for the CalFailureModeSvc</font>
00018 <font class="keyword">static</font> SvcFactory&lt;CalFailureModeSvc&gt; a_factory;
<a name="l00019"></a><a class="code" href="_cal_failure_mode_svc_8cxx.html#a1">00019</a> <font class="keyword">const</font> ISvcFactory&amp; <a class="code" href="_cal_failure_mode_svc_8cxx.html#a1">CalFailureModeSvcFactory</a> = a_factory; 
00020 
<a name="l00021"></a><a class="code" href="class_cal_failure_mode_svc.html#a0">00021</a> <a class="code" href="class_cal_failure_mode_svc.html#a0">CalFailureModeSvc::CalFailureModeSvc</a>(<font class="keyword">const</font> std::string&amp; name,ISvcLocator* svc) : Service(name,svc)
00022 {
00023     <font class="comment">// Purpose and Method: Constructor - Declares and sets default properties</font>
00024     <font class="comment">//                     </font>
00025     <font class="comment">// Inputs: service name and locator </font>
00026     <font class="comment">//         </font>
00027     <font class="comment">// Outputs: None</font>
00028     <font class="comment">// Dependencies: None</font>
00029     <font class="comment">// Restrictions and Caveats:  None</font>
00030     
00031     <font class="comment">// declare the properties</font>
00032 
00033     declareProperty(<font class="stringliteral">"towerList"</font>, <a class="code" href="class_cal_failure_mode_svc.html#o0">m_towerListProperty</a>);
00034     declareProperty(<font class="stringliteral">"towerLayerList"</font>, <a class="code" href="class_cal_failure_mode_svc.html#o1">m_towerLayerListProperty</a>);
00035 }
00036 
<a name="l00037"></a><a class="code" href="class_cal_failure_mode_svc.html#a6">00037</a> StatusCode  <a class="code" href="class_cal_failure_mode_svc.html#a6">CalFailureModeSvc::queryInterface</a> (<font class="keyword">const</font> IID&amp; riid, <font class="keywordtype">void</font> **ppvIF)
00038 {
00039     <font class="keywordflow">if</font> (IID_ICalFailureModeSvc == riid) {
00040         *ppvIF = dynamic_cast&lt;ICalFailureModeSvc*&gt; (this);
00041         <font class="keywordflow">return</font> StatusCode::SUCCESS;
00042     }
00043     <font class="keywordflow">else</font> {
00044         <font class="keywordflow">return</font> Service::queryInterface (riid, ppvIF);
00045     }
00046 }
00047 
<a name="l00048"></a><a class="code" href="class_cal_failure_mode_svc.html#a7">00048</a> <font class="keyword">const</font> IID&amp;  <a class="code" href="class_cal_failure_mode_svc.html#a7">CalFailureModeSvc::type</a> ()<font class="keyword"> const </font>{
00049     <font class="keywordflow">return</font> IID_ICalFailureModeSvc;
00050 }
00051 
<a name="l00052"></a><a class="code" href="class_cal_failure_mode_svc.html#a1">00052</a> StatusCode <a class="code" href="class_cal_failure_mode_svc.html#a1">CalFailureModeSvc::initialize</a> () 
00053 {
00054     <font class="comment">// Purpose and Method: Initialize the lists of dead units</font>
00055     <font class="comment">//                     </font>
00056     <font class="comment">// Inputs: None        </font>
00057     <font class="comment">// Outputs: None</font>
00058     <font class="comment">// Dependencies: None</font>
00059     <font class="comment">// Restrictions and Caveats:  None</font>
00060     
00061     StatusCode  status = StatusCode::SUCCESS;
00062     
00063     <font class="comment">// Open the message log</font>
00064     MsgStream log( msgSvc(), name() );
00065     
00066     <font class="comment">// Call super-class</font>
00067     Service::initialize ();
00068     
00069     <font class="comment">// Bind all of the properties for this service</font>
00070     <font class="keywordflow">if</font> ( (status = setProperties()).isFailure() ) {
00071         log &lt;&lt; MSG::ERROR &lt;&lt; <font class="stringliteral">"Failed to set properties"</font> &lt;&lt; endreq;
00072     }
00073     
00074     
00075     <a class="code" href="class_cal_failure_mode_svc.html#o2">m_failureModes</a> = 0;
00076     <a class="code" href="class_cal_failure_mode_svc.html#b2">processTowerList</a>();
00077     <a class="code" href="class_cal_failure_mode_svc.html#b3">processTowerLayerList</a>();
00078     
00079     <font class="keywordflow">return</font> StatusCode::SUCCESS;
00080 }
00081 
<a name="l00082"></a><a class="code" href="class_cal_failure_mode_svc.html#a3">00082</a> StatusCode <a class="code" href="class_cal_failure_mode_svc.html#a3">CalFailureModeSvc::finalize</a> () {<font class="keywordflow">return</font> StatusCode::SUCCESS;}
00083 
<a name="l00084"></a><a class="code" href="class_cal_failure_mode_svc.html#b3">00084</a> <font class="keywordtype">void</font> <a class="code" href="class_cal_failure_mode_svc.html#b3">CalFailureModeSvc::processTowerLayerList</a>() {
00085     <font class="comment">// Purpose and Method: process the jobOptions input lists of (tower,layer) pairs</font>
00086     <font class="comment">//                     </font>
00087     
00088     MsgStream log(msgSvc(), name());
00089     
00090     <font class="keyword">const</font> std::vector&lt;std::string&gt;&amp; theTowers = <a class="code" href="class_cal_failure_mode_svc.html#o1">m_towerLayerListProperty</a>.value( );
00091     <font class="keywordflow">if</font> (theTowers.size() == 0) <font class="keywordflow">return</font>;
00092 
00093     <a class="code" href="class_cal_failure_mode_svc.html#o2">m_failureModes</a> = <a class="code" href="class_cal_failure_mode_svc.html#o2">m_failureModes</a> || 1 &lt;&lt; <a class="code" href="class_cal_failure_mode_svc.html#s2s0">TOWER</a>;
00094 
00095     log &lt;&lt; MSG::DEBUG &lt;&lt; <font class="stringliteral">"Towers and Layers to kill "</font> &lt;&lt; endreq;
00096 
00097     std::vector&lt;std::string&gt;::const_iterator it;
00098     std::vector&lt;std::string&gt;::const_iterator itend = theTowers.end( );
00099     <font class="keywordflow">for</font> (it = theTowers.begin(); it != itend; it++) {
00100         <font class="keywordtype">int</font> len = (*it).size();
00101         <font class="keywordtype">int</font> delimPos = (*it).find_first_of(<font class="charliteral">'_'</font>);
00102         <font class="keywordtype">int</font> tower = atoi((*it).substr(0, delimPos).c_str());
00103         <font class="keywordtype">int</font> layer = atoi((*it).substr(delimPos+1, len-delimPos-1).c_str());
00104         log &lt;&lt; MSG::DEBUG &lt;&lt; <font class="stringliteral">"Tower "</font> &lt;&lt; tower &lt;&lt; <font class="stringliteral">" Layer "</font> &lt;&lt; layer &lt;&lt; endreq;
00105         std::vector&lt;int&gt;&amp; curList = <a class="code" href="class_cal_failure_mode_svc.html#o4">m_towerLayerList</a>[tower];
00106         curList.push_back(layer);                
00107     }
00108 }
00109 
<a name="l00110"></a><a class="code" href="class_cal_failure_mode_svc.html#b2">00110</a> <font class="keywordtype">void</font> <a class="code" href="class_cal_failure_mode_svc.html#b2">CalFailureModeSvc::processTowerList</a>() {
00111      <font class="comment">// Purpose and Method: process the jobOptions input lists of towers</font>
00112     <font class="comment">//                     </font>
00113    
00114     MsgStream log(msgSvc(), name());
00115     
00116     <font class="keyword">const</font> std::vector&lt;std::string&gt;&amp; theTowers = <a class="code" href="class_cal_failure_mode_svc.html#o0">m_towerListProperty</a>.value( );
00117 
00118     <font class="keywordflow">if</font> (theTowers.size() == 0) <font class="keywordflow">return</font>;
00119 
00120     log &lt;&lt; MSG::DEBUG &lt;&lt; <font class="stringliteral">"Towers to kill "</font> &lt;&lt; endreq;
00121 
00122     <a class="code" href="class_cal_failure_mode_svc.html#o2">m_failureModes</a> = <a class="code" href="class_cal_failure_mode_svc.html#o2">m_failureModes</a> || 1 &lt;&lt; <a class="code" href="class_cal_failure_mode_svc.html#s2s1">TOWERLAYER</a>;
00123 
00124     std::vector&lt;std::string&gt;::const_iterator it;
00125     std::vector&lt;std::string&gt;::const_iterator itend = theTowers.end( );
00126     <font class="keywordflow">for</font> (it = theTowers.begin(); it != itend; it++) {
00127         <font class="keywordtype">int</font> tower = atoi((*it).c_str());
00128         log &lt;&lt; MSG::DEBUG &lt;&lt; <font class="stringliteral">"Tower "</font> &lt;&lt; tower &lt;&lt; endreq;
00129         <a class="code" href="class_cal_failure_mode_svc.html#o3">m_towerList</a>.push_back(tower);
00130     }
00131 }
00132 
<a name="l00133"></a><a class="code" href="class_cal_failure_mode_svc.html#b0">00133</a> <font class="keywordtype">bool</font> <a class="code" href="class_cal_failure_mode_svc.html#b0">CalFailureModeSvc::matchTower</a>(idents::CalXtalId id) {
00134     <font class="comment">// Purpose and Method: check whether given id is in any of the identified lists</font>
00135     <font class="comment">//                     </font>
00136     
00137     <font class="keywordflow">if</font> (<a class="code" href="class_cal_failure_mode_svc.html#o3">m_towerList</a>.size() == 0) <font class="keywordflow">return</font> <font class="keyword">false</font>;
00138 
00139     <font class="keywordtype">int</font> tower = id.getTower();
00140     
00141     <font class="comment">// Search to see if this event id is among the list of ids we want to pause on</font>
00142     <font class="keywordtype">int</font> *loc = std::find(<a class="code" href="class_cal_failure_mode_svc.html#o3">m_towerList</a>.begin(), <a class="code" href="class_cal_failure_mode_svc.html#o3">m_towerList</a>.end(), tower);                
00143 
00144     <font class="keywordflow">return</font> (loc != <a class="code" href="class_cal_failure_mode_svc.html#o3">m_towerList</a>.end());
00145 }
00146 
<a name="l00147"></a><a class="code" href="class_cal_failure_mode_svc.html#b1">00147</a> <font class="keywordtype">bool</font> <a class="code" href="class_cal_failure_mode_svc.html#b1">CalFailureModeSvc::matchTowerLayer</a>(idents::CalXtalId id) {
00148     <font class="comment">// Purpose and Method: look for the given id in the tower list</font>
00149     <font class="comment">//                     </font>
00150     
00151     <font class="keywordflow">if</font> (<a class="code" href="class_cal_failure_mode_svc.html#o4">m_towerLayerList</a>.size() == 0) <font class="keywordflow">return</font> <font class="keyword">false</font>;
00152 
00153     <font class="keywordtype">int</font> tower = id.getTower();
00154     <font class="keywordtype">int</font> layer = id.getLayer();
00155     
00156     std::vector&lt;int&gt; &amp;layerList = <a class="code" href="class_cal_failure_mode_svc.html#o4">m_towerLayerList</a>[tower];
00157     
00158     <font class="comment">// Search to see if this (tower,layer) is among the list</font>
00159     <font class="keywordtype">int</font> *loc = std::find(layerList.begin(), layerList.end(), layer);                
00160     
00161     <font class="keywordflow">return</font> (loc != layerList.end());
00162 }
00163 
<a name="l00164"></a><a class="code" href="class_cal_failure_mode_svc.html#a5">00164</a> <font class="keywordtype">bool</font> <a class="code" href="class_cal_failure_mode_svc.html#a5">CalFailureModeSvc::matchChannel</a>(idents::CalXtalId id) {
00165     <font class="comment">// Purpose and Method: look for the given id in the (tower,layer) list</font>
00166     <font class="comment">//                     </font>
00167      
00168     <font class="keywordflow">if</font> (<a class="code" href="class_cal_failure_mode_svc.html#b0">matchTower</a>(id)) <font class="keywordflow">return</font> <font class="keyword">true</font>;
00169     <font class="keywordflow">if</font> (<a class="code" href="class_cal_failure_mode_svc.html#b1">matchTowerLayer</a>(id)) <font class="keywordflow">return</font> <font class="keyword">true</font>;
00170     
00171     <font class="keywordflow">return</font> <font class="keyword">false</font>;
00172 }
</pre></div><hr><address align="right"><small>Generated on Tue Oct 29 08:24:27 2002 for CalUtil by
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border=0 
width=110 height=53></a>1.2.16 </small></address>
</body>
</html>
